-- üí• ‡∏•‡∏ö Kavo UI ‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏≤‡∏á
pcall(function()
    for _, gui in ipairs(gethui():GetChildren()) do
        if gui:IsA("ScreenGui") and gui:FindFirstChild("MainFrame") then
            gui:Destroy()
        end
    end
end)

-- üî± ‡πÇ‡∏´‡∏•‡∏î Kavo UI
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()
local Window = Library.CreateLib("üåü Macro Controller", "Midnight")

-- üß† ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
local isRecording = false
local isAutoPlayAgain = false
local macroData = {}
local lastTime = tick()
local currentMode = "Easy"

-- üß† ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
local function recordMacro()
    local now = tick()
    local mouse = game:GetService("Players").LocalPlayer:GetMouse()
    table.insert(macroData, {
        delay = now - lastTime,
        pos = mouse.Hit and mouse.Hit.Position
    })
    lastTime = now
end

-- üß† ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏•‡πà‡∏ô‡∏ã‡πâ‡∏≥
local function playMacro()
    coroutine.wrap(function()
        for _, step in ipairs(macroData) do
            task.wait(step.delay)
            local tool = game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChildOfClass("Tool")
            if tool then tool:Activate() end
        end
    end)()
end

-- üß† ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Play Again
local function autoPlayAgain()
    for _, obj in pairs(game:GetDescendants()) do
        if obj:IsA("TextButton") and obj.Text:lower():find("play again") then
            firesignal(obj.MouseButton1Click)
            break
        end
    end
end

-- üìÅ ‡πÅ‡∏ó‡πá‡∏ö Main
local MainTab = Window:NewTab("Main")
local MacroSection = MainTab:NewSection("üéÆ Macro Controls")

MacroSection:NewButton("‚ñ∂Ô∏è Start Macro", "‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏´‡∏°‡πà", function()
    macroData = {}
    lastTime = tick()
end)

MacroSection:NewButton("üîÅ Play Macro", "‡πÄ‡∏•‡πà‡∏ô‡∏ã‡πâ‡∏≥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", function()
    playMacro()
end)

MacroSection:NewToggle("‚è∫Ô∏è Record", "‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å", function(state)
    isRecording = state
    lastTime = tick()
end)

MacroSection:NewToggle("üîÇ Auto Play Again", "‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° play again ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥", function(state)
    isAutoPlayAgain = state
end)

-- ‚öôÔ∏è ‡πÅ‡∏ó‡πá‡∏ö Settings
local SettingsTab = Window:NewTab("Settings")
local SettingsSection = SettingsTab:NewSection("‚öôÔ∏è Configuration")

SettingsSection:NewDropdown("Select Mode", "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î", {"Easy", "Normal", "Hard", "Insane"}, function(selected)
    currentMode = selected
end)

-- ‚ÑπÔ∏è ‡πÅ‡∏ó‡πá‡∏ö About
local InfoTab = Window:NewTab("About")
local InfoSection = InfoTab:NewSection("üìå Info")
InfoSection:NewLabel("‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢‡πÑ‡∏≠‡∏≠‡πâ‡∏ß‡∏á + ‡πÄ‡∏Ñ‡πâ‡∏≤‡πÄ‡∏≠‡∏á üíñ")

-- üîê Toggle UI visibility
local UIS = game:GetService("UserInputService")
UIS.InputBegan:Connect(function(input, gp)
    if not gp and input.KeyCode == Enum.KeyCode.RightShift then
        local main = gethui():FindFirstChild("MainFrame", true)
        if main then
            main.Visible = not main.Visible
        end
    end
end)

-- üîÅ ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ß‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏•‡πà‡∏ô
game:GetService("RunService").RenderStepped:Connect(function()
    if isRecording then recordMacro() end
    if isAutoPlayAgain then autoPlayAgain() end
end)
