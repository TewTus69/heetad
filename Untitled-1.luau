-- üí• ‡∏•‡∏ö GUI ‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô
pcall(function()
	for _, gui in ipairs(game:GetService("CoreGui"):GetChildren()) do
		if gui:IsA("ScreenGui") and gui:FindFirstChild("MainFrame") then
			gui:Destroy()
		end
	end
end)

-- üî± ‡πÇ‡∏´‡∏•‡∏î Kavo UI
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()
local Window = Library.CreateLib("üåä Macro Controller", "Ocean")

-- ‚öôÔ∏è ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ
local RS = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local Rep = game:GetService("ReplicatedStorage")
local remotes = Rep:WaitForChild("RemoteFunctions")

-- ü™ß Notification ‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏´‡∏£‡∏π
local notification = Instance.new("TextLabel")
notification.Parent = game:GetService("CoreGui")
notification.Size = UDim2.new(0, 300, 0, 40)
notification.Position = UDim2.new(0.5, -150, 0.05, 0)
notification.BackgroundColor3 = Color3.fromRGB(20, 60, 80)
notification.TextColor3 = Color3.fromRGB(255, 255, 255)
notification.Font = Enum.Font.GothamBold
notification.TextSize = 18
notification.Text = ""
notification.Visible = false
Instance.new("UICorner", notification)

local function notify(msg)
	notification.Text = msg
	notification.Visible = true
	task.delay(3, function()
		notification.Visible = false
	end)
end

-- üîß ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏´‡∏•‡∏±‡∏Å
local macroData = {}
local isRecording = false
local isPlaying = false
local autoPlayAgain = false
local autoStart = false
local currentMode = "Normal"
local lastRestart = 0
local restartCooldown = 10

-- üìÅ ‡πÅ‡∏ó‡πá‡∏ö Main
local mainTab = Window:NewTab("Main")
local section = mainTab:NewSection("üéÆ Macro Control")

section:NewButton("‚è∫Ô∏è Start Record", "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏°‡πÇ‡∏Ñ‡∏£", function()
	macroData = {}
	isRecording = true
	notify("‚è∫Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß")
end)

section:NewButton("üõë Stop Record", "‡∏´‡∏¢‡∏∏‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å", function()
	isRecording = false
	notify("üõë ‡∏´‡∏¢‡∏∏‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß")
end)

section:NewButton("‚ñ∂Ô∏è Play Macro", "‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å", function()
	if #macroData == 0 then return notify("‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏°‡πÇ‡∏Ñ‡∏£") end
	isPlaying = true
	notify("‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÅ‡∏°‡πÇ‡∏Ñ‡∏£")
	coroutine.wrap(function()
		for _, act in ipairs(macroData) do
			task.wait(act.delay or 0.5)
			if act.type == "place" then
				remotes.PlaceUnit:InvokeServer(act.unit, act.data)
			elseif act.type == "upgrade" then
				remotes.UpgradeUnit:InvokeServer(act.unitId)
			elseif act.type == "sell" then
				remotes.SellUnit:InvokeServer(act.unitId)
			end
		end
		isPlaying = false
	end)()
end)

section:NewToggle("üîÅ Auto Play Again", "‡∏£‡∏µ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏Å‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥", function(state)
	autoPlayAgain = state
	notify("üîÅ Auto Play Again: " .. tostring(state))
end)

section:NewToggle("üß± Auto Select Mode", "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏Å‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥", function(state)
	autoStart = state
	notify("üß± Auto Mode: " .. tostring(state))
end)

-- ‚öôÔ∏è ‡πÅ‡∏ó‡πá‡∏ö Settings
local settingsTab = Window:NewTab("Settings")
settingsTab:NewSection("‚öôÔ∏è Difficulty")
	:NewDropdown("Mode", "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö", {"Easy", "Normal", "Hard", "Insane"}, function(opt)
		currentMode = opt
		notify("‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏´‡∏°‡∏î: " .. opt)
	end)

-- üìå ‡πÅ‡∏ó‡πá‡∏ö About
Window:NewTab("About"):NewSection("‚ú¶ Info")
	:NewLabel("‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢‡πÑ‡∏≠‡∏≠‡πâ‡∏ß‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡πâ‡∏≤‡πÄ‡∏≠‡∏á üíô")

-- üéÆ Hook Remote ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
local oldPlace = remotes.PlaceUnit.InvokeServer
remotes.PlaceUnit.InvokeServer = function(_, unit, data)
	if isRecording then
		table.insert(macroData, {
			type = "place",
			unit = unit,
			data = data,
			delay = 0.3
		})
	end
	return oldPlace(remotes.PlaceUnit, unit, data)
end

local oldUpgrade = remotes.UpgradeUnit.InvokeServer
remotes.UpgradeUnit.InvokeServer = function(_, unitId)
	if isRecording then
		table.insert(macroData, {
			type = "upgrade",
			unitId = unitId,
			delay = 0.2
		})
	end
	return oldUpgrade(remotes.UpgradeUnit, unitId)
end

local oldSell = remotes.SellUnit.InvokeServer
remotes.SellUnit.InvokeServer = function(_, unitId)
	if isRecording then
		table.insert(macroData, {
			type = "sell",
			unitId = unitId,
			delay = 0.2
		})
	end
	return oldSell(remotes.SellUnit, unitId)
end

-- üïπÔ∏è RenderStep ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡πà‡∏ô‡∏ã‡πâ‡∏≥
RS.RenderStepped:Connect(function()
	-- üß± ‡πÇ‡∏´‡∏ß‡∏ï‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
	if autoStart then
		local ok, err = pcall(function()
			remotes.PlaceDifficultyVote:InvokeServer("dif_" .. currentMode:lower())
		end)
		if ok then
			notify("‚úÖ ‡πÇ‡∏´‡∏ß‡∏ï‡πÇ‡∏´‡∏°‡∏î " .. currentMode)
			autoStart = false
		else
			notify("‚ö†Ô∏è ‡πÇ‡∏´‡∏ß‡∏ï‡πÇ‡∏´‡∏°‡∏î‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: " .. tostring(err))
		end
	end

	-- üîÅ ‡∏£‡∏µ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏Å‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Timeout
	if autoPlayAgain and tick() - lastRestart > restartCooldown then
		pcall(function()
			for _, ui in ipairs(game.Players.LocalPlayer.PlayerGui:GetDescendants()) do
				if ui:IsA("TextLabel") and ui.Text and ui.Text:lower():find("overwhelmed") then
					-- üîî ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
					local reNotify = game:GetService("ReplicatedStorage"):FindFirstChild("ReNotifyEvent")
					if reNotify then
						reNotify:FireServer("NotificationOptionSelected", nil, "Timedout")
					end
					
					wait(0.5)

					-- üîÅ ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏£‡∏µ‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏Å‡∏°
					local ok, err = pcall(function()
						remotes.RestartGame:InvokeServer()
					end)

					if ok then
						lastRestart = tick()
						notify("üîÅ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!")
					else
						notify("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ: " .. tostring(err))
					end
					
					break
				end
			end
		end)
	end
end)



-- ‚å®Ô∏è ‡∏ã‡πà‡∏≠‡∏ô/‡πÅ‡∏™‡∏î‡∏á UI
UIS.InputBegan:Connect(function(input, gp)
	if not gp and input.KeyCode == Enum.KeyCode.RightShift then
		Window:Toggle()
	end
end)
